# é£žç‰› NAS (fnOS) éƒ¨ç½² Moltbot å®Œæ•´å®žæˆ˜æŒ‡å— (2026ç‰ˆ)

> **ç‰ˆæœ¬è¯´æ˜Ž**ï¼šæœ¬æŒ‡å—ç»¼åˆäº† **Moltbot å®˜æ–¹æ–‡æ¡£** ä¸Ž **é£žç‰› NAS (fnOS)** çš„ç½‘ç»œçŽ¯å¢ƒç‰¹æ€§ï¼Œæä¾›äº†â€œä¸€é”®è‡ªåŠ¨åŒ–â€å’Œâ€œæ‰‹åŠ¨åˆ†æ­¥â€ä¸¤ç§éƒ¨ç½²æ–¹æ¡ˆã€‚

---

## ðŸš€ æžé€Ÿéƒ¨ç½² (Quick Start) - æŽ¨èæ–¹æ¡ˆ

**v2.3 è‡ªåŠ¨åŒ–è„šæœ¬ (`deploy.sh`)** å·²ç»åŒ…å«åœ¨æœ¬ä»“åº“ä¸­ã€‚å®ƒä¼šè‡ªåŠ¨å¤„ç†ä»£ç æ‹‰å–ã€çŽ¯å¢ƒé€‚é…ã€é…ç½®ä¿®å¤ç­‰æ‰€æœ‰ç¹çæ­¥éª¤ã€‚

**ä½¿ç”¨æ–¹æ³•**ï¼š

1.  **ä¸‹è½½è„šæœ¬**ï¼š
    *   **æ–¹æ³• A (Git Clone æŽ¨è)**:
        ```bash
        # å°†æœ¬ä»“åº“æ‹‰å–åˆ° NAS ä»»æ„ç›®å½•
        git clone https://github.com/YourName/FNNAS_moltbot.git
        cd FNNAS_moltbot
        ```
    *   **æ–¹æ³• B (ç›´æŽ¥ä¸‹è½½)**:
        åœ¨ GitHub æ–‡ä»¶åˆ—è¡¨ä¸­ç‚¹å‡» `deploy.sh` -> ä¸‹è½½å¹¶ä¸Šä¼ åˆ° NASã€‚

2.  **æ‰§è¡Œå®‰è£…**ï¼š
    ```bash
    chmod +x deploy.sh
    sudo ./deploy.sh
    ```
    *(æ³¨æ„ï¼šè„šæœ¬ä¼šè‡ªåŠ¨æ£€æŸ¥å¹¶æ‹‰å– Moltbot æºç åˆ° `/vol1/moltbot`ï¼Œè¯·ç¡®ä¿æ‚¨æœ‰ sudo æƒé™)*

**è„šæœ¬æ ¸å¿ƒåŠŸèƒ½**ï¼š
*   âœ… **è‡ªåŠ¨æ‹‰å–**ï¼šè‡ªåŠ¨ clone å®˜æ–¹æºç ã€‚
*   âœ… **è‡ªåŠ¨é€‚é…**ï¼šä¿®æ­£ Dockerfile é€‚é… `node:25.5.0-bookworm`ã€‚
*   âœ… **ä¸€é”®ä¿®å¤**ï¼šè‡ªåŠ¨è§£å†³ Skills æ— æ³•åŠ è½½ã€æŒ‚è½½ä¸¢å¤±ç­‰é—®é¢˜ã€‚
*   âœ… **é˜²å‘†æ ¡éªŒ**ï¼šåŒ…å«æƒé™æ£€æŸ¥å’Œé•œåƒå­˜åœ¨æ€§æ ¡éªŒã€‚

---

## ðŸ“‹ å®Œæ•´æ‰‹åŠ¨æµç¨‹ (Manual Guide)

å¦‚æžœæ‚¨å¸Œæœ›äº†è§£éƒ¨ç½²ç»†èŠ‚ï¼Œæˆ–è€…è„šæœ¬æ‰§è¡Œé‡åˆ°é—®é¢˜ï¼Œè¯·å‚è€ƒä»¥ä¸‹æ‰‹åŠ¨æ­¥éª¤ã€‚

### ðŸ“… ç¬¬ä¸€æ­¥ï¼šä¸‹è½½æºç  (Get Code)
è¯·é€šè¿‡ SSH è¿žæŽ¥æ‚¨çš„ NAS ç»ˆç«¯ã€‚

**è·¯å¾„å»ºè®®**ï¼š`/vol1/moltbot` (ç›´æŽ¥åœ¨å­˜å‚¨å·æ ¹ç›®å½•ï¼Œæ•°æ®å®‰å…¨ä¸”æ˜“äºŽç®¡ç†)

```bash
# 1. è¿›å…¥å­˜å‚¨å·æ ¹ç›®å½•
cd /vol1

# 2. æ‹‰å–ä»£ç 
git clone https://github.com/moltbot/moltbot.git

# 3. è¿›å…¥é¡¹ç›®ç›®å½• (åŽç»­æ‰€æœ‰å‘½ä»¤éƒ½åœ¨è¿™é‡Œæ‰§è¡Œ)
cd moltbot
```

---

### ðŸ–¼ï¸ ç¬¬äºŒæ­¥ï¼šæ‰‹åŠ¨æ‹‰å–åŸºç¡€é•œåƒ (UI Pull Strategy)
**âš ï¸ å…³é”®ç‚¹**ï¼šç”±äºŽå›½å†… Docker Hub è®¿é—®å—é™ï¼Œè¯·**ä¸è¦**å°è¯•åœ¨å‘½ä»¤è¡Œç›´æŽ¥ pullï¼Œè€Œæ˜¯åˆ©ç”¨é£žç‰› NAS è‡ªå¸¦åŠ é€Ÿçš„ Web ç•Œé¢ã€‚

![é£žç‰› NAS Docker é•œåƒä»“åº“ç•Œé¢](images/feiniu_docker_registry.png)

**æ“ä½œæ­¥éª¤ (Standard Procedure)**ï¼š

1.  **Node.js (æ ¸å¿ƒçŽ¯å¢ƒ)**:
    Nasæ¡Œé¢è¿›å…¥Docker -> é•œåƒä»“åº“ -> æœç´¢ `node` ä¸‹è½½å‰é€‰æ‹©ç›¸åº”çš„é•œåƒæ ‡ç­¾ (æŽ¨è **`25.5.0-bookworm`**)

2.  **æ•°æ®åº“ (PostgreSQL)**:
    Nasæ¡Œé¢è¿›å…¥Docker -> é•œåƒä»“åº“ -> æœç´¢ `postgres` ä¸‹è½½å‰é€‰æ‹©ç›¸åº”çš„é•œåƒæ ‡ç­¾ (æŽ¨è `15-alpine`)

3.  **ç¼“å­˜ (Redis)**:
    Nasæ¡Œé¢è¿›å…¥Docker -> é•œåƒä»“åº“ -> æœç´¢ `redis` ä¸‹è½½å‰é€‰æ‹©ç›¸åº”çš„é•œåƒæ ‡ç­¾ (æŽ¨è `7-alpine`)

**ç¡®è®¤**ï¼šç­‰å¾…å·¦ä¾§ "æœ¬åœ°é•œåƒ" åˆ—è¡¨ä¸­å‡ºçŽ°è¿™ä¸‰ä¸ªç»¿è‰²çš„é•œåƒã€‚

---

### ðŸ› ï¸ ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹é…ç½® (Configuration)

#### 3.1 ä¿®æ”¹ Dockerfile (æŒ‡å®šåŸºç¡€é•œåƒ)
ç”±äºŽ Moltbot é»˜è®¤ä½¿ç”¨ `node:22-bookworm`ï¼Œè€Œæˆ‘ä»¬æœ¬åœ°ä¸‹è½½çš„æ˜¯ **`node:25.5.0-bookworm`**ï¼Œå¿…é¡»ä¿®æ”¹ Dockerfile ä»¥ç²¾ç¡®åŒ¹é…æœ¬åœ°é•œåƒï¼Œé¿å… Docker å°è¯•è”ç½‘é‡æ–°æ‹‰å–ã€‚

```bash
vi Dockerfile
```
**ä¿®æ”¹åŠ¨ä½œ**ï¼š
å°†æ–‡ä»¶å¼€å¤´çš„ `FROM` è¯­å¥æ”¹ä¸ºæ‚¨ä¸‹è½½çš„ç¡®åˆ‡ç‰ˆæœ¬ï¼š
`FROM node:25.5.0-bookworm`

åŒæ—¶ï¼Œæ‰¾åˆ° `ENV PATH` é™„è¿‘ï¼Œæ³¨å…¥ corepack ä¿®å¤ï¼š
```dockerfile
# ...
ENV PATH="/root/.bun/bin:${PATH}"
# [æ–°å¢ž] åŠ ä¸Š --force ä»¥è¦†ç›–å†²çªæ–‡ä»¶
RUN npm install -g corepack --force
RUN corepack enable
# ...
```

#### 3.2 ç³»ç»Ÿé…ç½®æ–‡ä»¶ (.env)
**âš ï¸ å®˜æ–¹è§„èŒƒ**ï¼š`.env` æ–‡ä»¶ä»…ç”¨äºŽé…ç½®**ç³»ç»Ÿçº§å‚æ•°**ã€‚AI æ¨¡åž‹çš„ Key è¯·åœ¨ç½‘é¡µé‡Œé…ã€‚

```bash
cp .env.example .env
vi .env
```
é…ç½®ç«¯å£å’Œæ•°æ®æŒä¹…åŒ–è·¯å¾„ï¼š
```env
PORT=3000
CLAWDBOT_CONFIG_DIR=./data
CLAWDBOT_WORKSPACE_DIR=./workspace
```

#### 3.3 ä¿®æ”¹ docker-compose.yml (æ ¸å¿ƒä¿®æ­£)
**è¿™æ˜¯ NAS éƒ¨ç½²æˆè´¥çš„å…³é”®**ã€‚è¯·åŠ¡å¿…ä¿®æ”¹ `volumes` æŒ‚è½½ï¼Œå¦åˆ™æŠ€èƒ½æ— æ³•åŠ è½½ã€‚

**Gateway æœåŠ¡**ï¼š
```yaml
environment:
  CLAWDBOT_SKILLS_DIR: /app/skills  # [æ–°å¢ž]
volumes:
  - ./skills:/app/skills            # [æ–°å¢ž]
```
**CLI æœåŠ¡**ï¼š
```yaml
volumes:
  - ./skills:/app/skills            # [æ–°å¢ž]
```

---

### ðŸš€ ç¬¬å››æ­¥ï¼šéƒ¨ç½²ä¸Žåˆå§‹åŒ– (Manual Build & Onboard)

#### 4.1 æ‰‹åŠ¨ç¼–è¯‘é•œåƒ
```bash
sudo docker build -t moltbot:local .
```

#### 4.2 åˆå§‹åŒ–ä¸Žç”Ÿæˆ Token
```bash
sudo docker compose --env-file .env run --rm moltbot-cli onboard
```
*   **æ³¨æ„**ï¼šè¯·åŠ¡å¿…**å¤åˆ¶**å±å¹•æœ€åŽæ˜¾ç¤ºçš„ **Gateway Token**ã€‚

#### 4.3 å¯åŠ¨æœåŠ¡
```bash
sudo docker compose up -d
```

---

### ðŸŒ ç¬¬äº”æ­¥ï¼šè®¿é—®ç­–ç•¥ (Access Strategy)

#### 5.1 å†…ç½‘è®¿é—®
è®¿é—® `http://[NAS_IP]:18789/?token=æ‚¨çš„Token`ã€‚
å¦‚æžœé‡åˆ° 1008 æŠ¥é”™ï¼Œè¯·åœ¨ `moltbot.json` ä¸­æ·»åŠ  `controlUi: { allowInsecureAuth: true }`ã€‚

#### 5.2 å¤–ç½‘è®¿é—® (fnConnect)
åˆ©ç”¨é£žç‰› NAS è‡ªå¸¦çš„ç©¿é€åŠŸèƒ½ã€‚

![FnConnect Access](images/fnos_link_access.png)

1.  åœ¨ Docker ç®¡ç†å™¨ä¸­ç‚¹å‡» Moltbot Gateway çš„é“¾æŽ¥å›¾æ ‡ã€‚
2.  **å…³é”®**ï¼šåœ¨æ‰“å¼€çš„ç½‘å€åŽé¢æ‰‹åŠ¨åŠ ä¸Š `?token=æ‚¨çš„Token`ã€‚

---

### âœ… ç¬¬å…­æ­¥ï¼šåŠŸèƒ½éªŒè¯ (Verification)

1.  **æ£€æŸ¥å¥åº·çŠ¶æ€**ï¼šç½‘é¡µå³ä¸Šè§’æ˜¾ç¤º **ðŸŸ¢ Health: Online**ã€‚
2.  **æµ‹è¯• AI å¯¹è¯**ï¼šå‘é€ `Hello`ï¼Œç¡®è®¤å›žå¤æ­£å¸¸ã€‚

![Verification Success](images/moltbot_chat_success.png)

---

## ðŸ“ é™„å½•ä¸€ï¼šOnboard æ—¥å¿—è§£æž
*   **Gateway Token**ï¼šç™»å½•å‡­è¯ã€‚
*   **Health check failed**ï¼šCLI è¿žä¸ä¸Š Gateway æ˜¯æ­£å¸¸çš„ï¼Œå¯å¿½ç•¥ã€‚

## ðŸ“ é™„å½•äºŒï¼šå¦‚ä½•ä¿®æ”¹ AI æ¨¡åž‹
ç›®å‰éœ€ä¿®æ”¹ `/vol1/moltbot/data/moltbot.json` å¹¶åœ¨ `.env` ä¸­æ·»åŠ  API Keyã€‚

## ðŸ“ é™„å½•ä¸‰ï¼šå¦‚ä½•å¼€å¯è”ç½‘æœç´¢ (Tavily)
æŽ¨èä½¿ç”¨ Tavily (å…è´¹ä¸”æ— éœ€ä¿¡ç”¨å¡)ã€‚
åœ¨ `.env` ä¸­æ·»åŠ ï¼š
```bash
TAVILY_API_KEY=tvly-xxxxxxxx
```
ç„¶åŽé‡å¯å®¹å™¨ã€‚

## ðŸ“ é™„å½•å››ï¼šå¦‚ä½•å‡çº§ Moltbot
æŽ¨èæµç¨‹ï¼š`git stash` -> `git pull` -> `git stash pop` -> `docker build` -> `docker compose up -d`ã€‚
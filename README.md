# é£ç‰› NAS (fnOS) éƒ¨ç½² Moltbot å®Œæ•´å®æˆ˜æŒ‡å— (2026ç‰ˆ)

> **ç‰ˆæœ¬è¯´æ˜**ï¼šæœ¬æŒ‡å—ç»¼åˆäº† **Moltbot å®˜æ–¹æ–‡æ¡£ (Manual Flow)** ä¸ **é£ç‰› NAS (fnOS)** çš„ç½‘ç»œç¯å¢ƒç‰¹æ€§ï¼Œç»è¿‡å®æˆ˜éªŒè¯ï¼Œæ˜¯æœ€ç¨³å¦¥çš„éƒ¨ç½²æ–¹æ¡ˆã€‚

## ğŸ“‹ æ ¸å¿ƒæµç¨‹æ€»è§ˆ
1.  **å‡†å¤‡ä»£ç **ï¼šGit Clone æºç ã€‚
2.  **æå®šé•œåƒ**ï¼šåˆ©ç”¨ fnOS ç•Œé¢è§£å†³ç½‘ç»œä¸‹è½½é—®é¢˜ã€‚
3.  **é€‚é…ç¯å¢ƒ**ï¼šä¿®æ”¹ Dockerfile å’Œç³»ç»Ÿé…ç½®ã€‚
4.  **æ‰‹åŠ¨éƒ¨ç½²**ï¼šBuild -> Onboard -> Up (å®˜æ–¹æ¨èçš„ç¨³å¥è·¯å¾„)ã€‚
5.  **ç½‘é¡µé…ç½®**ï¼šåœ¨ Web ç•Œé¢ä¸­è®¾ç½® AI æ¨¡å‹ã€‚

---

## ğŸ“… ç¬¬ä¸€æ­¥ï¼šä¸‹è½½æºç  (Get Code)
è¯·é€šè¿‡ SSH è¿æ¥æ‚¨çš„ NAS ç»ˆç«¯ã€‚

**è·¯å¾„å»ºè®®**ï¼š`/vol1/moltbot` (ç›´æ¥åœ¨å­˜å‚¨å·æ ¹ç›®å½•ï¼Œæ•°æ®å®‰å…¨ä¸”æ˜“äºç®¡ç†)

```bash
# 1. è¿›å…¥å­˜å‚¨å·æ ¹ç›®å½•
cd /vol1

# 2. æ‹‰å–ä»£ç 
git clone https://github.com/moltbot/moltbot.git

# 3. è¿›å…¥é¡¹ç›®ç›®å½• (åç»­æ‰€æœ‰å‘½ä»¤éƒ½åœ¨è¿™é‡Œæ‰§è¡Œ)
cd moltbot
```

---

## ğŸ–¼ï¸ ç¬¬äºŒæ­¥ï¼šæ‰‹åŠ¨æ‹‰å–åŸºç¡€é•œåƒ (UI Pull Strategy)
**âš ï¸ å…³é”®ç‚¹**ï¼šç”±äºå›½å†… Docker Hub è®¿é—®å—é™ï¼Œè¯·**ä¸è¦**å°è¯•åœ¨å‘½ä»¤è¡Œç›´æ¥ pullï¼Œè€Œæ˜¯åˆ©ç”¨é£ç‰› NAS è‡ªå¸¦åŠ é€Ÿçš„ Web ç•Œé¢ã€‚

![é£ç‰› NAS Docker é•œåƒä»“åº“ç•Œé¢](/Users/apple/.gemini/antigravity/brain/a02e076a-b042-4883-9fac-b1d245ac5ddc/feiniu_docker_registry.png)

**æ“ä½œæ­¥éª¤ (Standard Procedure)**ï¼š

1.  **Node.js (æ ¸å¿ƒç¯å¢ƒ)**:
    Nasæ¡Œé¢è¿›å…¥Docker -> é•œåƒä»“åº“ -> æœç´¢ `node` ä¸‹è½½å‰é€‰æ‹©ç›¸åº”çš„é•œåƒæ ‡ç­¾ (æ¨è **`25.5.0-bookworm`**)

2.  **æ•°æ®åº“ (PostgreSQL)**:
    Nasæ¡Œé¢è¿›å…¥Docker -> é•œåƒä»“åº“ -> æœç´¢ `postgres` ä¸‹è½½å‰é€‰æ‹©ç›¸åº”çš„é•œåƒæ ‡ç­¾ (æ¨è `15-alpine`)

3.  **ç¼“å­˜ (Redis)**:
    Nasæ¡Œé¢è¿›å…¥Docker -> é•œåƒä»“åº“ -> æœç´¢ `redis` ä¸‹è½½å‰é€‰æ‹©ç›¸åº”çš„é•œåƒæ ‡ç­¾ (æ¨è `7-alpine`)

**ç¡®è®¤**ï¼šç­‰å¾…å·¦ä¾§ "æœ¬åœ°é•œåƒ" åˆ—è¡¨ä¸­å‡ºç°è¿™ä¸‰ä¸ªç»¿è‰²çš„é•œåƒã€‚

---

## ğŸ› ï¸ ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹é…ç½® (Configuration)

### 3.1 ä¿®æ”¹ Dockerfile (æŒ‡å®šåŸºç¡€é•œåƒ)
ç”±äº Moltbot é»˜è®¤ä½¿ç”¨ `node:22-bookworm`ï¼Œè€Œæˆ‘ä»¬æœ¬åœ°ä¸‹è½½çš„æ˜¯ **`node:25.5.0-bookworm`**ï¼Œå¿…é¡»ä¿®æ”¹ Dockerfile ä»¥ç²¾ç¡®åŒ¹é…æœ¬åœ°é•œåƒï¼Œé¿å… Docker å°è¯•è”ç½‘é‡æ–°æ‹‰å–ã€‚

```bash
vi Dockerfile
```
**ä¿®æ”¹åŠ¨ä½œ**ï¼š
å°†æ–‡ä»¶å¼€å¤´çš„ `FROM` è¯­å¥æ”¹ä¸ºæ‚¨ä¸‹è½½çš„ç¡®åˆ‡ç‰ˆæœ¬ï¼š

```bash
vi Dockerfile
```
**ä¿®æ”¹åŠ¨ä½œ**ï¼š
æ‰¾åˆ° `ENV PATH="/root/.bun/bin:${PATH}"` è¿™ä¸€è¡Œï¼Œåœ¨å®ƒ**ä¸‹é¢**æ’å…¥ä¸€è¡Œå®‰è£…å‘½ä»¤ï¼š

```dockerfile
# ... ä¸Šé¢çš„ä¸è¦åŠ¨ ...
ENV PATH="/root/.bun/bin:${PATH}"

# --- ä¿®æ­£ï¼šåŠ ä¸Š --force ä»¥è¦†ç›–å†²çªæ–‡ä»¶ ---
RUN npm install -g corepack --force

RUN corepack enable
# ... ä¸‹é¢çš„ä¹Ÿä¸è¦åŠ¨ ...
```
*(ä¿å­˜é€€å‡ºï¼šæŒ‰ `Esc` -> è¾“å…¥ `:wq` -> å›è½¦ä¿å­˜)*

### 3.2 ç³»ç»Ÿé…ç½®æ–‡ä»¶ (.env)
**âš ï¸ å®˜æ–¹è§„èŒƒ**ï¼š`.env` æ–‡ä»¶ä»…ç”¨äºé…ç½®**ç³»ç»Ÿçº§å‚æ•°**ï¼ˆå¦‚ç«¯å£ã€å­˜å‚¨è·¯å¾„ï¼‰ã€‚AI æ¨¡å‹çš„ Key è¯·**ä¸è¦**åœ¨è¿™é‡Œé…ç½®ï¼Œç¨ååœ¨ç½‘é¡µé‡Œé…ã€‚

```bash
cp .env.example .env
vi .env
```
**å»ºè®®ä¿®æ”¹å†…å®¹**ï¼š
```env
# --- åŸºç¡€æœåŠ¡ ---
PORT=3000

# --- æ•°æ®æŒä¹…åŒ– (æ¨èå¼€å¯) ---
# å®šä¹‰ä¸€ä¸ª Docker Volume æ¥ä¿å­˜æ‰€æœ‰æ•°æ® (/home/node)
# è¿™æ ·é‡å¯å®¹å™¨æˆ–æ›´æ–°é•œåƒåï¼Œæ‚¨çš„èŠå¤©è®°å½•å’Œé…ç½®ä¸ä¼šä¸¢å¤±
CLAWDBOT_HOME_VOLUME="moltbot_home"

# --- é¢å¤–ä¾èµ– (å¯é€‰) ---
# å¦‚æœæ‚¨éœ€è¦è¯­éŸ³è½¬æ–‡å­—åŠŸèƒ½ï¼Œå¯èƒ½éœ€è¦ ffmpeg
# CLAWDBOT_DOCKER_APT_PACKAGES="ffmpeg"

# --- æ•°æ®æŒä¹…åŒ– (æ¨èå¼€å¯) ---
# å®šä¹‰ä¸€ä¸ª Docker Volume æ¥ä¿å­˜æ‰€æœ‰æ•°æ® (/home/node)
# è¿™æ ·é‡å¯å®¹å™¨æˆ–æ›´æ–°é•œåƒåï¼Œæ‚¨çš„èŠå¤©è®°å½•å’Œé…ç½®ä¸ä¼šä¸¢å¤±
CLAWDBOT_CONFIG_DIR=./data
CLAWDBOT_WORKSPACE_DIR=./workspace


### 3.3 ä¿®æ”¹ docker-compose.yml (æ ¸å¿ƒä¿®æ­£)
**è¿™æ˜¯ NAS éƒ¨ç½²æˆè´¥çš„å…³é”®**ã€‚ä¸ºäº†è®© Moltbot èƒ½æ­£ç¡®åŠ è½½æŠ€èƒ½ (Skills)ï¼Œæˆ‘ä»¬å¿…é¡»ä¿®æ”¹é»˜è®¤çš„é…ç½®æ–‡ä»¶ã€‚
è¯·æ‰§è¡Œï¼š
```bash
vi docker-compose.yml
```
**ä¸€å…±éœ€è¦ä¿®æ”¹ 3 å¤„** (è¯·åŠ¡å¿…ä»”ç»†æ ¸å¯¹)ï¼š

**ä¿®æ”¹ 1ï¼šå‘Šè¯‰ Gateway æŠ€èƒ½åœ¨å“ªé‡Œ (Environment)**
åœ¨ `moltbot-gateway` -> `environment` ä¸‹ï¼Œæ·»åŠ ï¼š
```yaml
      CLAWDBOT_SKILLS_DIR: /app/skills  # <--- [æ–°å¢] å¼ºåˆ¶æŒ‡å®šæŠ€èƒ½è·¯å¾„
```

**ä¿®æ”¹ 2ï¼šç»™ Gateway æŒ‚è½½æŠ€èƒ½ç›®å½• (Volume)**
åœ¨ `moltbot-gateway` -> `volumes` ä¸‹ï¼Œæ·»åŠ ï¼š
```yaml
      - ./skills:/app/skills            # <--- [æ–°å¢] æŒ‚è½½æŠ€èƒ½æ–‡ä»¶
```

**ä¿®æ”¹ 3ï¼šç»™ CLI æŒ‚è½½æŠ€èƒ½ç›®å½• (Volume)**
åœ¨ `moltbot-cli` -> `volumes` ä¸‹ï¼ŒåŒæ ·æ·»åŠ ï¼š
```yaml
      - ./skills:/app/skills            # <--- [æ–°å¢] ç¡®ä¿å·¥å…·ä¹Ÿèƒ½å†™è¿›å»
```

*(ä¿®æ”¹å®Œåï¼šæŒ‰ `Esc` -> è¾“å…¥ `:wq` -> å›è½¦ä¿å­˜)*

---

## ğŸš€ ç¬¬å››æ­¥ï¼šéƒ¨ç½²ä¸åˆå§‹åŒ– (Official Manual Flow)
ä¸ºäº†é¿å…å®˜æ–¹è„šæœ¬ `docker-setup.sh` åœ¨ NAS ç²¾ç®€ç¯å¢ƒä¸‹æŠ¥é”™æˆ–è¦†ç›–é…ç½®ï¼Œæˆ‘ä»¬é‡‡ç”¨**å®˜æ–¹æ–‡æ¡£æ¨èçš„æ‰‹åŠ¨ä¸‰æ­¥èµ°**ã€‚

### 4.1 æ‰‹åŠ¨ç¼–è¯‘é•œåƒ (Manual Build)
**ä¿®æ­£è¯´æ˜**ï¼šç”±äºå®˜æ–¹ `docker-compose.yml` æ–‡ä»¶ä¸­æœªåŒ…å«æ„å»ºæŒ‡ä»¤ï¼Œç›´æ¥è¿è¡Œ compose build æ— æ•ˆã€‚æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è§¦å‘æ„å»ºã€‚
```bash
sudo docker build -t moltbot:local .
```
*   **æ³¨æ„**ï¼šå‘½ä»¤æœ€åæœ‰ä¸€ä¸ªç‚¹ `.`ï¼Œä»£è¡¨å½“å‰ç›®å½•ã€‚
*   **é¢„æœŸ**ï¼šå±å¹•ä¼šæ»šåŠ¨æ˜¾ç¤ºæ„å»ºè¿‡ç¨‹ (build steps)ï¼Œè€—æ—¶çº¦å‡ åˆ†é’Ÿã€‚å®Œæˆåè¾“å…¥ `docker images` èƒ½çœ‹åˆ° `moltbot:local`ã€‚

### 4.2 åˆå§‹åŒ–ä¸ç”Ÿæˆ Token (Onboard)
é•œåƒå‡†å¤‡å¥½åï¼Œåˆå§‹åŒ–æ•°æ®åº“å¹¶ç”Ÿæˆç®¡ç†å‘˜å‡­è¯ã€‚
```bash
sudo docker compose --env-file .env run --rm moltbot-cli onboard
```
*   **å‚æ•°è¯´æ˜**ï¼š`--env-file .env` å¼ºåˆ¶åŠ è½½é…ç½®æ–‡ä»¶ï¼Œç¡®ä¿ç³»ç»Ÿè·¯å¾„æ­£ç¡®ã€‚
*   **æ“ä½œ**ï¼šè¯·åŠ¡å¿…**å¤åˆ¶å¹¶ä¿å­˜**å±å¹•æœ€åæ˜¾ç¤ºçš„ **Gateway Token**ã€‚

### 4.3 å¯åŠ¨æœåŠ¡ (Start)
```bash
sudo docker compose up -d
```

**å…³äºçº¢è‰² CLI å®¹å™¨ (Normal Behavior)**:
`moltbot-cli` å®¹å™¨æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œé»˜è®¤è¿è¡Œå®Œå¸®åŠ©å‘½ä»¤åä¼šè‡ªåŠ¨é€€å‡º (æ˜¾ç¤ºçº¢è‰² Stopped)ï¼Œè¿™æ˜¯**å®Œå…¨æ­£å¸¸**çš„ã€‚
åªè¦ `moltbot-gateway` (ç½‘å…³) æ˜¯ç»¿è‰²çš„ (Running)ï¼Œæ‚¨çš„æœåŠ¡å’Œç½‘é¡µè®¿é—®å°±ä¸€åˆ‡æ­£å¸¸ã€‚æ— éœ€æ‹…å¿ƒ CLI çš„çŠ¶æ€ã€‚


---

## ğŸŒ ç¬¬äº”æ­¥ï¼šè®¿é—®ç­–ç•¥ (Access Strategy)

### 5.1 å†…ç½‘è®¿é—® (å±€åŸŸç½‘ Local Access)
1.  **è®¿é—®åœ°å€**ï¼š
    âš ï¸ **é‡è¦**ï¼šè¯·ä½¿ç”¨ NAS çš„å±€åŸŸç½‘ IP è®¿é—®ï¼Œä¸è¦ç”¨ localhostã€‚
    `http://[æ‚¨çš„IP]:18789/?token=cbt_xxxxx`
    *(ä¾‹å¦‚ï¼š`http://192.168.101.101:18789/...`)*

2.  **è§£å†³ IP è®¿é—®æŠ¥é”™ (HTTP 1008)**ï¼š
    å¦‚æœæ‚¨çœ‹åˆ°çº¢è‰²æŠ¥é”™ `disconnected (1008): control ui requires HTTPS or localhost`ï¼Œæ˜¯å› ä¸ºæµè§ˆå™¨é˜»æ­¢äº†é HTTPS çš„ç™»å½•ã€‚
    **è§£å†³æ–¹æ³•**ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶å¼€å¯ HTTP æ”¯æŒã€‚
    
    ```bash
    # ç¼–è¾‘é…ç½®æ–‡ä»¶
    vi /vol1/moltbot/data/moltbot.json
    ```
    
    åœ¨ `"gateway": { ... }` å†…éƒ¨æ’å…¥ `"controlUi"` é…ç½®ï¼š
    ```json
    "gateway": {
      // ... å…¶ä»–é…ç½®ä¿æŒä¸å˜ ...
      "controlUi": {
        "allowInsecureAuth": true
      },
      // ... å…¶ä»–é…ç½® ...
    }
    ```
    *(ä¿®æ”¹å®Œåæ‰§è¡Œ `sudo docker compose restart` é‡å¯ç”Ÿæ•ˆ)*



**è‡³æ­¤ï¼ŒMoltbot éƒ¨ç½²å¤§åŠŸå‘Šæˆï¼ğŸ‰**

### 5.2 å¤–ç½‘è®¿é—® (External - fnConnect)

åˆ©ç”¨é£ç‰› NAS (0.9.27+) çš„åŸç”Ÿ fnConnect åŠŸèƒ½ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²ä»»ä½•ä»£ç†åŠå¤æ‚é…ç½®ã€‚

![FnConnect Access](/Users/apple/.gemini/antigravity/brain/a02e076a-b042-4883-9fac-b1d245ac5ddc/fnos_link_access.png)

**æ“ä½œæ­¥éª¤**ï¼š
1.  æ‰“å¼€ **é£ç‰› Docker ç®¡ç†å™¨** -> **å®¹å™¨åˆ—è¡¨**ã€‚
2.  æ‰¾åˆ° **moltbot-gateway-1** å®¹å™¨ï¼ˆæ³¨æ„æ˜¯ Gatewayï¼Œä¸æ˜¯ CLIï¼‰ã€‚
3.  åœ¨å³ä¾§å¯ä»¥çœ‹åˆ°ä¸€ä¸ª **ğŸ”— (é“¾æ¥)** å›¾æ ‡ã€‚
4.  ç‚¹å‡»è¯¥å›¾æ ‡ï¼Œé€‰æ‹© **`18789:18789`**ã€‚
5.  ç³»ç»Ÿä¼šè‡ªåŠ¨æ‰“å¼€ä¸€ä¸ªæ–°ç½‘é¡µï¼Œé€šè¿‡ fnConnect éš§é“è®¿é—® Moltbotã€‚

6.  âš ï¸ **å…³é”®ä¿®å¤ (å¿…è¯»)**ï¼š
    ç”±äºå®‰å…¨æœºåˆ¶ï¼Œé£ç‰›è‡ªåŠ¨ç”Ÿæˆçš„é“¾æ¥**ä¸å¸¦ Token**ï¼Œç›´æ¥æ‰“å¼€ä¼šæŠ¥é”™ `disconnected (1008): unauthorized`ã€‚
    
    **è§£å†³æ–¹æ³•**ï¼š
    è¯·æ‰‹åŠ¨åœ¨æµè§ˆå™¨åœ°å€æ çš„æœ«å°¾ï¼ŒåŠ ä¸Šæ‚¨çš„ Tokenï¼š
    `?token=æ‚¨çš„Token` (ä¾‹å¦‚ `?token=d3f9bf7b...`)

**åŸç†**ï¼š
ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«æš´éœ²çš„ç«¯å£ï¼Œå¹¶åˆ†é…äºŒçº§å­åŸŸåã€‚è¿™æ¯”æ‰‹åŠ¨é…ç½®åä»£ç®€å•å¾—å¤šã€‚

---

## âœ… ç¬¬å…­æ­¥ï¼šåŠŸèƒ½éªŒè¯ (Verification)

1.  **æ£€æŸ¥å¥åº·çŠ¶æ€**ï¼š
    *   çœ‹ç½‘é¡µå³ä¸Šè§’ï¼Œåº”è¯¥æ˜¾ç¤º **ğŸŸ¢ Health: Online** (æˆ–ç±»ä¼¼ç»¿è‰²çŠ¶æ€)ã€‚
    *   (æ³¨æ„ï¼šCLI çš„çº¢è‰²ä¸å½±å“è¿™é‡Œï¼Œåªè¦ Gateway æ´»ç€å°±è¡Œ)

2.  **æµ‹è¯• AI å¯¹è¯**ï¼š
    *   ç‚¹å‡»å·¦ä¾§ **"Chat"** èœå•ã€‚
    *   åœ¨è¾“å…¥æ¡†å‘é€ï¼š`Hello` æˆ– `ä½ å¥½`ã€‚
    *   **é¢„æœŸ**ï¼šAI èƒ½æ­£å¸¸å›å¤ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ã€‚
    
    ![Verification Success](/Users/apple/.gemini/antigravity/brain/a02e076a-b042-4883-9fac-b1d245ac5ddc/moltbot_chat_success.png)

    *   *å¦‚æœ AI ä¸å›æˆ–è€…æŠ¥é”™*ï¼šè¯´æ˜ API Key å¯èƒ½æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒâ€œé™„å½•äºŒâ€å»ä¿®æ”¹ `.env` é‡Œçš„ Keyã€‚

---

## ğŸ“ é™„å½•ä¸€ï¼šOnboard è¾“å‡ºä¿¡æ¯è§£æ (å…³é”®æ—¥å¿—)
åœ¨æ‰§è¡Œ `onboard` åˆå§‹åŒ–æ­¥éª¤æ—¶ï¼Œæ‚¨å¯èƒ½ä¼šçœ‹åˆ°ä¸€å¤§ä¸²æ—¥å¿—ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå…³é”®ç‚¹çš„è§£è¯»ï¼š

1.  **Gateway Token (æ ¸å¿ƒå‡­è¯)**
    *   **æ—¥å¿—ä½ç½®**ï¼š`â—‡ Dashboard ready ... Web UI (with token): http://127.0.0.1:18789/?token=d3f9...`
    *   **è¯´æ˜**ï¼šè¿™æ˜¯æ‚¨ç”¨æ¥ç™»å½•çš„å”¯ä¸€å‡­è¯ã€‚è™½ç„¶æ—¥å¿—æ˜¾ç¤ºçš„æ˜¯ `127.0.0.1`ï¼Œä½†å®é™…ä¸Šæ‚¨éœ€è¦æŠŠ IP æ¢æˆæ‚¨çš„ **NAS å±€åŸŸç½‘ IP** æ‰èƒ½è®¿é—®ï¼ˆå‚è€ƒç¬¬äº”æ­¥ï¼‰ã€‚

2.  **Health check failed (å¯å¿½ç•¥çš„æŠ¥é”™)**
    *   **æ—¥å¿—æ ·æœ¬**ï¼š`Health check failed: gateway closed (1006 abnormal closure...)`
    *   **åŸå› **ï¼šè¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ Docker å®¹å™¨å†…è¿è¡Œ CLIï¼Œå®ƒè¯•å›¾é€šè¿‡ `localhost` è¿æ¥ç½‘å…³ã€‚ä½†åœ¨ Docker éš”ç¦»ç¯å¢ƒä¸­ï¼ŒCLI å®¹å™¨å’Œ Gateway å®¹å™¨æ˜¯éš”ç¦»çš„ï¼Œæ‰€ä»¥è¿™é‡Œè¿æ¥ä¸ä¸Šæ˜¯**å®Œå…¨æ­£å¸¸**çš„ï¼ˆLocal loopback ä¸é€šï¼‰ã€‚
    *   **ç»“è®º**ï¼šåªè¦çœ‹åˆ° Token ç”Ÿæˆäº†ï¼Œè¿™ä¸ªçº¢è‰²æŠ¥é”™**ç›´æ¥å¿½ç•¥**ã€‚

3.  **Web Search (å¯ç”¨è”ç½‘æœç´¢)**
    *   **æç¤º**ï¼šæ—¥å¿—ä¸­æåˆ° `Moltbot uses Brave Search ...`
    *   **é…ç½®æ–¹æ³•**ï¼šå¦‚æœæ‚¨å¸Œæœ› AI èƒ½è”ç½‘æœç´¢ï¼Œå»ç”³è¯·ä¸€ä¸ª Brave Search API Keyï¼Œç„¶ååŠ åˆ° `.env` æ–‡ä»¶é‡Œï¼š
        ```bash
        BRAVE_API_KEY=your_key_here
        ```
    *   é‡å¯å®¹å™¨åç”Ÿæ•ˆã€‚

---

## ğŸ“ é™„å½•äºŒï¼šå¦‚ä½•ä¿®æ”¹ AI æ¨¡å‹ (Change AI Model)

Moltbot çš„æ¨¡å‹é…ç½®ä¸åœ¨ç½‘é¡µ Settings é‡Œï¼Œè€Œæ˜¯**å¿…é¡»ä¿®æ”¹é…ç½®æ–‡ä»¶**ã€‚

1.  **ä¿®æ”¹æ¨¡å‹æŒ‡å‘**ï¼š
    ```bash
    vi /vol1/moltbot/data/moltbot.json
    ```
    æ‰¾åˆ° `"agents"` éƒ¨åˆ†ï¼Œä¿®æ”¹é»˜è®¤æ¨¡å‹ (`primary`)ã€‚ä¾‹å¦‚é…ç½®æ™ºè°± AI (Zhipu / Z.AI)ï¼š
    ```json
    "agents": {
      "defaults": {
        "model": {
          "primary": "zai/glm-4.7"  // è®¾ç½®ä¸ºä¸»æ¨¡å‹
        }
      }
    }
    ```

2.  **ä¿®æ”¹ API Key**ï¼š
    ```bash
    vi /vol1/moltbot/.env
    ```
    **æ³¨æ„**ï¼š`.env` é»˜è®¤æ²¡æœ‰è¿™ä¸ªå˜é‡ï¼Œè¯·åœ¨æ–‡ä»¶æœ«å°¾**æ‰‹åŠ¨æ·»åŠ **ä¸€è¡Œï¼š
    ```bash
    ZAI_API_KEY=your_key_here
    ```
    *(ä¿®æ”¹å®Œåæ‰§è¡Œ `sudo docker compose restart` é‡å¯ç”Ÿæ•ˆ)*

---

---

## ğŸ“ é™„å½•ä¸‰ï¼šå¦‚ä½•å¼€å¯è”ç½‘æœç´¢ (Tavily - æ— éœ€ä¿¡ç”¨å¡)

æ—¢ç„¶ Brave éœ€è¦ä¿¡ç”¨å¡ï¼Œå¼ºçƒˆæ¨èä½¿ç”¨ **Tavily Search**ã€‚å®ƒæ˜¯ä¸“é—¨ä¸º AI Agent è®¾è®¡çš„æœç´¢å¼•æ“ï¼Œæœç´¢ç»“æœå¯¹ AI æ›´å‹å¥½ï¼Œè€Œä¸”**å…è´¹ç‰ˆä¸éœ€è¦ç»‘å®šä¿¡ç”¨å¡**ã€‚

**1. è´¹ç”¨è¯´æ˜ (Free Tier)**
*   **å…è´¹é¢åº¦**ï¼šæ¯æœˆ **1,000 æ¬¡**æœç´¢ã€‚
*   **æ— éœ€ä¿¡ç”¨å¡**ï¼šæ³¨å†Œå³ç”¨ï¼Œéå¸¸é€‚åˆä¸ªäººå¼€å‘è€…ã€‚

**2. è·å– API Key**
*   è®¿é—® [Tavily å®˜ç½‘ (brave.com)](https://tavily.com/) å¹¶æ³¨å†Œè´¦å·ã€‚
*   åœ¨ Dashboard ç”Ÿæˆä¸€ä¸ªæ–°çš„ API Keyã€‚

**3. é…ç½®æ–¹æ³•**
ä¿®æ”¹ `.env` æ–‡ä»¶ï¼š
```bash
vi /vol1/moltbot/.env
```
åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ï¼š
```bash
# æ³¨æ„å˜é‡åæ˜¯ TAVILY_API_KEY
TAVILY_API_KEY=tvly-xxxxxxxx
```

**4. é‡å¯ç”Ÿæ•ˆ**
```bash
sudo docker compose restart
```

**5. æ¿€æ´»æŠ€èƒ½ (Skill Activation)**
é‡å¯åï¼Œè¯·åœ¨ç½‘é¡µç«¯å¯ç”¨ Tavilyï¼š
1.  è¿›å…¥ **Skills** (å·¦ä¾§èœå•)ã€‚
2.  æœç´¢ `Tavily`ã€‚
3.  ç‚¹å‡» **Enable** (å¦‚æœæŒ‰é’®æ˜¾ç¤ºä¸º Disableï¼Œè¯´æ˜å·²ç»å¯ç”¨)ã€‚
    *(æ³¨æ„ï¼šç”±äºè¿™æ˜¯çº¯å‡€å®‰è£…ç‰ˆï¼Œç³»ç»Ÿä¸­æ²¡æœ‰é»˜è®¤çš„ Brave Searchï¼Œæ‰€ä»¥ä¸éœ€è¦æ‰§è¡Œç¦ç”¨æ“ä½œï¼Œç›´æ¥å¯ç”¨ Tavily å³å¯)*

    *   **å¦‚æœæœä¸åˆ° Tavily**ï¼šè¯´æ˜éœ€è¦æ£€æŸ¥æŠ€èƒ½ç›®å½•æ˜ å°„æ˜¯å¦æ­£ç¡®ï¼ˆå‚è€ƒæ­£æ–‡ 3.3 èŠ‚ï¼‰ã€‚å¦‚æœç¡®è®¤æ²¡é—®é¢˜ï¼Œå¯å°è¯•æ‰‹åŠ¨é‡è£…ï¼š
        ```bash
        # é‡æ–°è¿è¡Œ Starter Pack å®‰è£…å‘½ä»¤
        sudo docker run --rm -v $(pwd):/app -w /app node:25.5.0-bookworm /bin/sh -c "npm install -g undici clawdhub && clawdhub install --force tavily"
        ```
        å®‰è£…å®Œæˆåï¼Œå»ºè®®é‡å¯ä¸€ä¸‹å®¹å™¨ï¼š`sudo docker compose restart`ã€‚

### âš ï¸ å…³é”®ä¿®å¤ï¼šå¼ºåˆ¶æŒ‡å®š Skills è·¯å¾„ (Critical Fix)
*(å·²åˆå¹¶åˆ°æ­£æ–‡æ­¥éª¤ 3.3ï¼Œå¦‚æœæ‚¨å·²ç»æ‰§è¡Œè¿‡ 3.3ï¼Œè¯·è·³è¿‡æ­¤æ®µ)*

### ğŸ æ¨èæŠ€èƒ½ä¸€é”®å®‰è£…åŒ… (Starter Pack)
**è¿™æ˜¯å”¯ä¸€èƒ½ç¡®ä¿æ–‡ä»¶å†™å…¥ç¡¬ç›˜çš„å®‰è£…æ–¹å¼**ï¼ˆè§£å†³äº† Docker å®¹å™¨æ–‡ä»¶ä¸¢å¤±é—®é¢˜ï¼‰ï¼š

```bash
# æ­¤å‘½ä»¤ä½¿ç”¨ node:25.5.0-bookworm é•œåƒï¼ŒæŒ‚è½½å½“å‰ç›®å½•(-v)ï¼Œå¹¶æŒ‡å®šå·¥ä½œç›®å½•(-w)ï¼Œç¡®ä¿æŠ€èƒ½å†™å…¥ç¡¬ç›˜
sudo docker run --rm -v $(pwd):/app -w /app node:25.5.0-bookworm /bin/sh -c "npm install -g undici clawdhub && clawdhub install --force tavily && clawdhub install --force github && clawdhub install --force summarize && clawdhub install --force weather"
```
*(åŒ…å«ï¼šTavilyæœç´¢ã€GitHubç®¡ç†ã€ç½‘é¡µæ€»ç»“ã€å¤©æ°”æŸ¥è¯¢)*

**âš ï¸ å®‰è£…åå¿…é¡»é‡å¯ (Required)**ï¼š
```bash
sudo docker compose restart
```


---

## ğŸ“ é™„å½•å››ï¼šå¦‚ä½•å‡çº§ Moltbot (Upgrade Guide)

ç”±äºæˆ‘ä»¬å¯¹ `Dockerfile` å’Œ `docker-compose.yml` åšäº†æœ¬åœ°ä¿®æ”¹ï¼Œ**ç›´æ¥ `git pull` ä¼šå¯¼è‡´åˆå¹¶å†²çªæˆ–é…ç½®ä¸¢å¤±**ã€‚
è¯·åŠ¡å¿…æŒ‰ç…§ä»¥ä¸‹â€œæ— æŸå‡çº§â€æµç¨‹æ“ä½œï¼š

**1. æš‚å­˜ä¿®æ”¹ (Stash)**
å…ˆæŠŠæˆ‘ä»¬çš„ä¿®æ”¹ï¼ˆNode ç‰ˆæœ¬ã€æŒ‚è½½ç›®å½•ã€ç¯å¢ƒå˜é‡ï¼‰æš‚æ—¶â€œè—â€èµ·æ¥ï¼š
```bash
cd /vol1/moltbot
git stash
```

**2. æ‹‰å–æ›´æ–° (Pull)**
è·å–å®˜æ–¹æœ€æ–°ä»£ç ï¼š
```bash
git pull
```

**3. æ¢å¤ä¿®æ”¹ (Pop)**
æŠŠè—èµ·æ¥çš„ä¿®æ”¹â€œç›–â€å›å»ï¼š
```bash
git stash pop
```
*   **é¡ºåˆ©æƒ…å†µ**ï¼šæ˜¾ç¤º `Dropped refs/...`ï¼Œè¯´æ˜è‡ªåŠ¨åˆå¹¶æˆåŠŸã€‚
*   **å†²çªæƒ…å†µ**ï¼šå¦‚æœæç¤º `Conflict`ï¼Œè¯´æ˜å®˜æ–¹ä¹Ÿæ”¹äº†ç›¸å…³æ–‡ä»¶ã€‚æ­¤æ—¶æ‚¨å¯èƒ½éœ€è¦ç”¨ `vi` æ‰“å¼€å†²çªæ–‡ä»¶è§£å†³ï¼Œæˆ–è€…å¹²è„†**é‡ç½®**åé‡æ–°æ‰§è¡Œä¸€éæœ¬æ–‡æ¡£çš„ **Step 3.1** å’Œ **Step 3.3**ã€‚

**4. é‡æ–°æ„å»ºä¸å¯åŠ¨ (Rebuild)**
å› ä¸ºä»£ç å˜äº†ï¼Œå¿…é¡»é‡æ–°ç¼–è¯‘é•œåƒï¼š
```bash
# 1. é‡æ–°æ„å»º (è¿™ä¼šåˆ©ç”¨ä¹‹å‰çš„ç¼“å­˜ï¼Œé€Ÿåº¦è¾ƒå¿«)
sudo docker build -t moltbot:local .

# 2. é‡å¯å®¹å™¨ (æ›´æ–°è¿è¡Œä¸­çš„æœåŠ¡)
sudo docker compose up -d

# 3. (å¯é€‰) æ¸…ç†æ—§é•œåƒ (é‡Šæ”¾ç©ºé—´)
sudo docker image prune -f
```

---

## ğŸ“ é™„å½•äº”ï¼šæ‡’äººä¸€é”®è„šæœ¬ (One-Click Automation)

## ğŸ“ é™„å½•äº”ï¼šæ‡’äººä¸€é”®è„šæœ¬ (One-Click Automation)

**v2.3 æ›´æ–°**ï¼š
1.  **è‡ªåŠ¨æ‹‰å–ä»£ç **ï¼šè„šæœ¬å¯ä»¥åœ¨ä»»æ„ç›®å½•è¿è¡Œï¼Œè‡ªåŠ¨ç®¡ç†ä»£ç ã€‚
2.  **é•œåƒç¡¬æ ¸æ ¡éªŒ**ï¼šè‡ªåŠ¨æ£€æŸ¥é•œåƒæ˜¯å¦å­˜åœ¨ã€‚
3.  **æƒé™æ§åˆ¶**ï¼šå¼ºåˆ¶è¦æ±‚ `sudo` è¿è¡Œï¼Œé˜²æ­¢æƒé™ä¸è¶³æŠ¥é”™ã€‚

**ä½¿ç”¨æ–¹æ³•**ï¼š

1.  **åˆ›å»ºè„šæœ¬æ–‡ä»¶** (å¯åœ¨ä»»æ„ä½ç½®)ï¼š
    ```bash
    vi deploy.sh
    ```
    *(ç²˜è´´ä¸‹æ–¹è„šæœ¬å†…å®¹)*

2.  **æ‰§è¡Œå®‰è£…**ï¼š
    ```bash
    chmod +x deploy.sh
    sudo ./deploy.sh  # (æ³¨æ„å¿…é¡»åŠ  sudo)
    ```

**è„šæœ¬å†…å®¹ (`deploy.sh`)**ï¼š
```bash
#!/bin/bash
GREEN='\033[0;32m'; YELLOW='\033[1;33m'; RED='\033[0;31m'; NC='\033[0m'
DEFAULT_NODE_IMAGE="node:25.5.0-bookworm"
TARGET_DIR="/vol1/moltbot"
REPO_URL="https://github.com/moltbot/moltbot.git"

echo -e "${GREEN}=== Moltbot NAS äº¤äº’å¼éƒ¨ç½² v2.3 ===${NC}"

# 0. æƒé™æ£€æŸ¥
if [[ $EUID -ne 0 ]]; then
   echo -e "${RED}é”™è¯¯:è¯·ä½¿ç”¨ sudo è¿è¡Œæ­¤è„šæœ¬${NC}"; exit 1
fi

# 1. æ£€æŸ¥ç›®å½•ä¸ä»£ç 
if [ ! -d "/vol1" ]; then echo -e "${RED}é”™è¯¯: æœªæ‰¾åˆ° /vol1 å­˜å‚¨å·${NC}"; exit 1; fi
if [ ! -d "$TARGET_DIR" ]; then
    echo -e "${YELLOW}æœªæ£€æµ‹åˆ°é¡¹ç›®ï¼Œæ­£åœ¨å…‹éš†ä»£ç ...${NC}"
    cd /vol1 && git clone "$REPO_URL"
fi
cd "$TARGET_DIR"

# 2. äº¤äº’é…ç½®
read -p "è¯·ç¡®è®¤æ˜¯å¦å·²åœ¨ NAS ç•Œé¢æ‰‹åŠ¨æ‹‰å– Node é•œåƒ? (y/n) [y]: " PULLED
if [[ "$PULLED" == "n" ]]; then echo "æ“ä½œæŒ‡å¼•: Nasæ¡Œé¢è¿›å…¥Docker -> é•œåƒä»“åº“ -> æœç´¢ node ä¸‹è½½å‰é€‰æ‹©ç›¸åº”çš„é•œåƒæ ‡ç­¾"; exit 0; fi
read -p "è¯·è¾“å…¥é•œåƒ Version Tag [é»˜è®¤ $DEFAULT_NODE_IMAGE]: " NODE_IMAGE
NODE_IMAGE=${NODE_IMAGE:-$DEFAULT_NODE_IMAGE}

# æ ¡éªŒé•œåƒ
if [[ "$(sudo docker images -q $NODE_IMAGE 2> /dev/null)" == "" ]]; then
    echo -e "${RED}é”™è¯¯: æœªæ‰¾åˆ°æœ¬åœ°é•œåƒ '$NODE_IMAGE'${NC}"
    echo "æ“ä½œæŒ‡å¼•: Nasæ¡Œé¢è¿›å…¥Docker -> é•œåƒä»“åº“ -> æœç´¢ node ä¸‹è½½å‰é€‰æ‹©ç›¸åº”çš„é•œåƒæ ‡ç­¾"; exit 1
fi
echo -e "å·²ç¡®è®¤ä½¿ç”¨åŸºç¡€é•œåƒ: ${GREEN}$NODE_IMAGE${NC}"

# 3. ä¿®æ­£ Dockerfile
echo -e "${YELLOW}[1/5] é€‚é…é•œåƒ...${NC}"
if [ ! -f "Dockerfile.bak" ]; then cp Dockerfile Dockerfile.bak; fi
sed -i "s/^FROM node:.*/FROM ${NODE_IMAGE}/" Dockerfile
if ! grep -q "npm install -g corepack" Dockerfile; then
    sed -i '/ENV PATH="\/root\/.bun\/bin:${PATH}"/a RUN npm install -g corepack' Dockerfile
fi

# 4. ç”Ÿæˆé…ç½®è¦†ç›–
echo -e "${YELLOW}[2/5] ç”Ÿæˆé…ç½®ä¿®æ­£æ–‡ä»¶...${NC}"
cat > docker-compose.override.yml <<EOF
services:
  moltbot-gateway:
    environment:
      CLAWDBOT_SKILLS_DIR: /app/skills
      TAVILY_API_KEY: \${TAVILY_API_KEY}
    volumes:
      - ./skills:/app/skills
  moltbot-cli:
    volumes:
      - ./skills:/app/skills
EOF

# 5. æ„å»ºä¸å®‰è£…
echo -e "${YELLOW}[3/5] æ„å»ºé•œåƒ...${NC}"
sudo docker build -t moltbot:local .

echo -e "${YELLOW}[4/5] å®‰è£…æŠ€èƒ½...${NC}"
mkdir -p skills
sudo docker run --rm -v $(pwd):/app -w /app $NODE_IMAGE /bin/sh -c "npm install -g undici clawdhub && clawdhub install --force tavily && clawdhub install --force github && clawdhub install --force summarize && clawdhub install --force weather"

# 6. å¯åŠ¨
echo -e "${YELLOW}[5/5] å¯åŠ¨æœåŠ¡...${NC}"
sudo docker compose up -d
echo -e "${GREEN}æ‰€æœ‰å·¥ä½œå·²å®Œæˆï¼è¯·è®¿é—®ç½‘é¡µæ£€æŸ¥ã€‚${NC}"
```